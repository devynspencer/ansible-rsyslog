{{ ansible_managed | comment }}

{% for server in rsyslog_relays -%}

{# don't configure self as remote log destination #}
{% if server != ansible_fqdn -%}

# send logs to remote relay: {{ server }}
#
$ActionQueueFileName        forward_logs_to_{{ server }}
$ActionQueueMaxDiskSpace    1g
$ActionQueueSaveOnShutdown  on
$ActionQueueType            LinkedList
$ActionResumeRetryCount     -1
$ActionFileDefaultTemplate  {{ rsyslog_action_template }}
*.* @@{{ server }}:{{ rsyslog_relay_port }}

{% endif %}
{% endfor %}
