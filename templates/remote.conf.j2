{{ ansible_managed | comment }}

{% include "json.part.j2" %}

{%- for remote in rsyslog_destinations if (remote != ansible_fqdn) -%}

#
# remote server: {{ remote.server }}:{{ remote.port }}
# log format: {{ remote.format }}
#
$ActionQueueFileName        {{ remote.server }}.queue
$ActionQueueMaxDiskSpace    1g
$ActionQueueSaveOnShutdown  on
$ActionQueueType            LinkedList
$ActionResumeRetryCount     -1
$ActionFileDefaultTemplate  {{ rsyslog_action_template }}
*.* @@{{ remote.server }}:{{ remote.port | default(rsyslog_port) }}{% if remote.format == "json" %};as_json{% endif %}

{% else -%}
#
# uh-oh!
#
# It looks like no remote destinations have been configured for this
# server to send its logs to!
#
# To configure a destination, add the following to the appropriate
# group_vars or host_vars file:
#
#   syslog_destinations: ["server.example.com"]
{%- endfor -%}
